{% extends 'widgets/content.html' %}

{% block title %}Index{% endblock %}

{% block script %}
<script>
    jwt = sessionStorage.getItem('token')
    if (jwt) {
        axios.defaults.headers.common['Authorization'] = `Bearer ${jwt}`
    }
    axios.get(
        "{{ url_for('api.blog') }}"
    ).then(resp => {
        for (b of resp.data.blogs) {
            if (b.editable) {
                $("#blog").append(
                `<div class="d-flex">
                    <div class="col-12 mb-1 border-top pt-1">
                        <a class="h3" href=/blog/view/${b.id}>${b.title}</a>
                        <a class="ms-1 text-info after-title" href=/blog/update/${b.id}?jwt=${jwt}>编辑(暂不可用)</a>
                        <p class="text-secondary text-sm"><small>by ${b.author_name} on ${b.created}</small></p>
                    </div>
                </div>`)
            } else {
                $("#blog").append(
                `<div class="d-flex">
                    <div class="col-12 mb-1 border-top pt-1">
                        <a class="h3" href=/blog/view/${b.id}>${b.title}</a>
                        <p class="text-secondary text-sm"><small>by ${b.author_name} on ${b.created}</small></p>
                    </div>
                </div>`)
            }
        }
        $("#blog").append("<hr>")
    })
</script>
{% endblock %}

{% block content %}
<div class="row" id="blog">
</div>
{% endblock %}